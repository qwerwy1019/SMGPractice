21/04/24
rotate랑 move가 updateActionChart안에서 일어나는 일은 일단은 없다고 봐야할듯. 나중에 추가된다면 작업해야겠지만, 회전하는 애니메이션이 있고, rotate가 중간에 격렬하게 바뀔 일도 거의 없어보임 -> 이거는 정확히는, updateActionChart쪽에서는 move rotate type과 속도값을 셋팅하고, 실제로 이동/회전 시키는 것은 바깥쪽에서 하는걸로 한다.

물체의 rotation을 계산할때, 회전량 값을 저장해서 같이 matrix에 누적으로 곱하라고 했었는데... float 오차가 나지 않을까? rotation 최종 값에서 결과 matrix를 만들어냈으면 좋겠는데 -> 축이 있으면 행렬은 나온다...

21/04/29
감속
가속(방향바뀜 반영)
가속(방향 고정)

가속(~으로 이동)

캐릭터의 방향과 조이스틱 방향값은 구분되어야함.
y축 속도는 따로 관리(어차피 중력이랑 상호작용 되어야함)
가속 감속 점프 회전 타입변경 프레임이벤트가 필요함. 속도max값, 가속도값 옵션 필요.

 프레임이벤트의 기준은 tick으로 한다.
end condition을 타고 액션이 바뀔때 이전 액션의 모든 프레임이벤트를 실행하고 새 액션의 0프레임이벤트까지 실행해야할지 하나만 해야할지 결정해야함-> 현재 tick까지(포함) 이벤트를 실행한다는 개념으로 생각하면 둘다 하는게 맞음.

21/05/12
회전에도 각속도가 반영되어야 할 것같다. 바로 휙휙 꺾이는 느낌은 아닌듯. 좀 이상한 느낌이긴 하지만 현재 방향과 조이스틱 방향, 카메라방향을 통해 상대적으로 몇도를 꺾어야 하는지 구한 다음 그 각도를 목표로 각속도만큼씩 꺾는 방식을 써야할듯 

21/05/14
애니메이팅이 없는 액터도 localTick이 필요하다. 애니메이션의 currentTick과 Actor의 localTickCount는 둘다 유지되어야한다.

21/05/22
unique_ptr 멤버변수를 가진 클래스가 vector reallocate에 의해 복사될때 터지는것같다 -> ActionState -> ActionBranch 구간이었던것 같은데 테스트해보니까 안터짐... ActionCondition의 소멸자가 virtual이 아니어서 발생한 문제라고 추정하는데 재현이 안돼서 확신은 못하겠음.

21/05/24
createObjectFromXML에서 commandList flush를 한번에 할수 있게 인터페이스를 만들어야함. (stageLoad시 여러 액터를 소환할때는 한번에 flush되어야하고 게임 중간에 액터 소환시 액터 하나마다 flush 되어야 함)
-> queue에 쌓아놨다가 loop마다 체크해서 flush하는 방법은 어떨지 고려해봐야할듯(이렇게까지 할 필요는 없을것 같기도 하지만...)

21/05/26
terrain object list가 필요하다. 거기에 있는 polygon들이 sector별로 검색 가능해야한다.
raycast할때 이 폴리곤이 첫번째 충돌하는 폴리곤이란걸 확신할 수 없으면 결국 전체를 다 돌아야 할텐데... normal로 거르는걸로 만족해야하나? 찾아봐야할듯

21/06/05
클래스 초기화 빠트린거 전부 챙겨야함
SkinnedVertexShader와 NormalVertexShader를 분리해야함. pipeline state object도 분리해야함 -> 분리하지 않는게 이득일지는 고민해봐야 하지만, 두가지가 섞이는 순간 헬게이트 열릴듯.

21/06/07
VS를 분리할지 아니면 Draw단계에서 skinned가 아닐 경우를 구분하는 인자를 바인딩해줄지 -> 결국 skinned vertex와 일반 vertex의 input description이 달라서 통합할 수가 없었다. 분리했음

21/06/08
배경 오브젝트 배치, Lstick Rstick 입력 만들기, 
배경에 노멀이 이상한건 블렌더에서 어떻게 다시 뽑아보던가 아무튼 외부에서 해결해야할듯.

21/06/12
FBX VERTEX에서 NORMAL뽑을때 평균을 내지 않는 문제가 있음. 이걸 고치면 위의 문제가 해결 될 수도 있다. 그리고 이것과는 별개로 NORMAL이 아주 많이 차이가 나는 VERTEX의 경우 분리를 해야할지? 애매한것같다.

21/06/13
점 하나에 노멀이 너무 서로 다르게 나오는데 잘못된건지 확인 필요
해결 : index가 uint16_t 범위(65535)를 넘어가서면서 발생한 문제였다. normal 값이 같은 점이 0번 버텍스와 67000쯤의 버텍스가 같이 발견되어서 알 수 있었다.

21/06/17
회전할때 카메라가 덜컹거리는 이슈
-> 이동 거리가 deltaSpeed보다 작을때 업데이트 하는 구문을 빼먹었다.

21/06/20
deltaTick * speed * (계수)식의 구문에서 계수를 체계적으로 관리할 필요가 있어보임.
오차가 누적되면서 direction과 upVector가 normal이 아니게 되지 않도록 조치해야함 -> 이 문제가 카메라가 드드득거리는 현상으로 나타남

21/06/24
오르막을 생각 못했다.. 일반 move랑 gravity에 의한 move를 다르게 처리해야 하나?
wall과 ground로 체크 플래그를 만드는것을 고려했었음.
terrainObject를 characterInfo 없이 actor없이 따로 관리하는게 맞는걸까? -> Actor가 GameObject를 상속받게 구조 변경하고 싶음. GameObject를 상속받는 Terrain이라는 클래스를 만들면 좋을듯

21/06/25
XMINT를 XMVECTOR로 만들어서 XMFLOAT를 로드한거랑 곱하면 어떻게 되는지 확인해야할듯 -> 이 문제로 terrainAABB 만들다가 값이 0이 나오는 문제가 있었음.
terrainObject를 어떻게 처리할지 고민중

21/06/29
무엇과 언제 충돌했는지, 그 충돌이 이동 거리에 영향을 주는지 같은걸 어떻게 전달할지 정해야 할것같다.

21/07/01
폴리곤이 폴리곤이 아닌 경우, 예를 들어 두 점의 위치가 같다던가, 모두 일직선상에 있다던가 하는 케이스에 대한 예외처리 규정을 정해야한다. -> plane이 정상적이지 않은 경우 충돌하지 않은것으로 처리함

21/07/02
fbx optimizedVertex에서 normal이 비슷한 점을 합칠때, 평균값 합쳐놓은게 하나여서 다른방향 점들은 서로 합쳐지지 않는 문제가 있다. 땅이 좀 각져보일수 있다. 추후 확인.
fbx optimizedVertex에 버그가 있는것 같다. 다른 점으로 합쳐지는 문제가 있는것 같다. -> 노트패드에서 인덱스 잘못 읽어서 착각함. 줄수는 1부터 시작했다..

21/07/04
외적으로 삼각형 내부 찾는부분 너무 이상하다... 위에 교점이 이동거리 밖에 있는 경우도 체크하는 로직 넣어햐함. -> 해결. 콤마 오퍼레이터가 있다는걸 몰라서 버그를 못찾고 있었음.

21/07/08
checkGround는완벽하게 충돌 체크를 하면 경사면에서 발이 떠있는것처럼 보이기 때문에 중력방향으로 키 높이만큼만 떠있는 걸로 체크를 했다. 그런데 checkWall은 정확히 체크가 되어야 하는 부분이 아닐까? -> 근데 어차피 지금 rotate시 충돌 체크를 안하고 있는데... 회전을 해도 파고들지 못할 위치까지만 움직여줘야 하는거 아닐까?? -> 벽타기만 자연스럽게 나온다면 어찌되든 크게 상관없긴 할듯? 높이 제외한 가로 세로만 raidus구해서 체크하면 될것같은데? -> checkGround는 땅이 거의 90도에 가깝게 올라올 일이 없었지만... 벽을 옆으로 뭉개니 심각하게 이상하다...
지금 땅 체크는 절벽같은 지형에서 캐릭터 가운데 지점을 통과하면 떨어지기 시작하는 문제떄문에 땅 체크도 triangle vs sphere를 사용해야 한다고 생각하고 있었는데...정말일까?
충돌 위치를 정확하게 구한다고 해도, 결국엔 미끄러짐이 구현되어야 모양이 예쁘게 나오는거 아닐까? 이 게임은 fps 게임이 아니니까 정확한 궤도 충돌 판정보다 충돌 시 서로를 밀어내는 상호작용이 더 중요한거 아닌가?

collisionShape를 box로만 사용하는건 어떨까? 지형까지만 폴리곤으로 처리하면... 그리고 진행하는 방향의 면으로만 충돌체크를 하는거임. -> 아니면 타협해서, 지형 체크를 할때는 무조건 박스 취급하는건?
-> Sphere가 필요한 경우 : npc캐릭터를 밟으면 동그란 모양이 뜸. 코코넛 열매같은 오브젝트, OBB로는 충돌 여부만 판단이되니까 경로 계산을 하려면 sphere가 낫다고 생각했었음.
뚫으면 안되는건 지형까지로 놓고, 다른건 적당히 판정만 한다면 이부분은 괜찮을것이다.

그리고 일반 액터끼리 checkCollision도 정확히 체크 되고 누구랑 충돌했는지 정보도 줘야한다.
충돌 관련 작업이 전반적으로 많이 남았다고 보고 다 구현을 하긴 해야할듯? 

21/07/12
충돌한 것들 목록을 저장해야 하는데, 동시에 충돌한 경우가 체크가 될까?? -> 땅은 그냥 땅과 충돌했는지만 체크 되면 되고, 액터간의 충돌은 별도 로직을 만들기로 함

21/07/13
box와 triangle의 충돌을 rectangle (최대3개)와 triangle 충돌로 만들려했는데, 중복으로 검사되는 문제가 있다. (edge는 2번, vertex는 3번)

21/07/14
direction -> -Z
upVector -> +Y
direction X upVector -> +X

vector의 w는 0으로, point의 w는 1로 통일하는걸 고려해봐야하나?

intersectLineWithLine 함수가 자꾸 값이 이상하게 나오는듯.

21/07/16
이펙트, 잔상, 파츠(꿀벌 마리오 날개, 스핀할때 나오는 별캐릭터), 그림자, 동적색인화와 절두체선별, ui

21/07/28
카메라 타입을 좀 더 고민해봐야할듯. 특히 기본 카메라에서 따라가는 속도같은거를 어떻게 설정하는게 예쁠지 생각해봐야함. 가까운 거리에서 자잘하게 움직일때는 카메라를 느리게 움직이다가 멀리 이동하면 빠르게 따라가줘야함

21/07/30
굼바가 제대로 안나오던 이슈는 mesh파일을 새로 뽑힌걸 업데이트를 안해줘서였음. mesh 안에 weightBondeIndex가 있다는걸 간과했음.
액터간의 충돌은 일단 이동시킨 후 서로 밀어내도록 하기로 했다. 그런데 전체 액터를 서로 충돌체크 하기보다는 이동을 한 액터에 대해서만 체크를 하는게 좋지 않을까? 
이동한 액터 <-> 이동한 액터
이동한 액터 <-> 정지한 액터
정지한 액터 <-> 이동한 액터

정지한 액터 <-> 정지한 액터 : 생략(이걸 어떻게 구현할지) 이걸 isMoving으로?

21/08/04
플레이어와 적이 충돌했을때 승패 판정이 들어가야 하지 않을까? 굼바를 밟았을때는 데미지를 입지 않지만 그 이외에 충돌했을때는 데미지를 입는다. 만약 발만 충돌 범위로 제한한다고 해도 가끔씩 밟히는 판정은 안났는데 데미지 판정도 안나는 일이 발생할것이다.

하드웨어 인스턴싱은 많이 반복되는 렌더항목에 대해 유효할텐데 지금 게임에 나오는 오브젝트들 중에 반복되는게 별사탕정도밖에 없다. 이펙트 구현할때만 사용하는게 좋아보임.
지금 구현해놓은 Actor->GameObject->RenderItems 구조는 여러개의 반복되는 물체가 있어도 각각의 Actor라고 봐야해서 구조가 꼬임.

21/08/09
targetActor를 만들기 싫은 이유 : 해당 액터가 죽었을때 나를 타겟하고 있는 액터에 가서 타겟 액터를 지워줘야함. 나를 타겟하는 액터 리스트가 필요하게 됨.
결국 충돌 체크가 일어나는 시점에서 부딪친 액터 방향으로 회전이 일어나야함.
_rotateAngleOffset을 써야할것같음.
충돌 이벤트 발생시 rotateAngleOffset이 설정되어야 한다는 플래그를 어디에 넣어야 할까?
EventHandler가 필요한 상황이 충돌 말고도 있나?

21/08/15
EffectInstance를 vector로 할지 array로 할지
-> 스테이지마다 사용할 이펙트를 리스트업한다고 해도 사용량이 다를텐데 array로 해도 의미가 없지 않나?

21/08/17
문제상황: shadowMap에 물체가 있는 부분은 거의 0으로 그려지고 있음. 그래서 물체를 실제로 렌더링할때 shadowPosHCS를 통해 shadowMap에서 샘플링해오면 0이 나와서 전체에 그림자가 진 것처럼 보인다.
깊이 판정에 성공했으니까 값이 쓰였을텐데, 왜 그 값이 0이었을까? d24_s8이었으니까 depth stencil write를 하면 r24에 깊이값이, g8에 스텐실 값이 써졋어야 했을 것이다.
case 1: 실제로 d24 값이 0이었다?
기존 passConstant를 통해 깊이버퍼를 써도 0이 나온다. 실제로 이랬다면 게임화면이 정상적으로 나오고 있었을 리가 없다.
case 2: 판정은 제대로 됐지만 잘못된 값(0)을 버퍼에 쓰고 있다.
case 3: 깊이 값이 제대로 버퍼에 써졌지만 그 텍스쳐를 다시 읽을때 제대로 읽지 못하고 있다.
예제파일을 돌려봤더니 깊이텍스쳐를 일반 텍스쳐처럼 출력해봐도 잘 나왔다. 가능성이 낮을듯.
case 4: 사실 값은 제대로 써져있고 차이가 매우 작아서 색이 비슷해보이는 경우
depth값이 몇부터 0이고 몇부터 1인지 알아야함.
해결 : ShadowMap의 viewPort 를 초기화할때 minDepth, maxDepth를 설정하지 않았다.

21/08/18
넣고싶은 이펙트 목록
흙먼지(걸어다닐때 등)
반짝이(별npc, 코인, 별 획득시)
여러색깔 반짝이(별npc, 스핀어택)
둥근 조명
포탈타고 날아갈때 혜성꼬리같은거
마우스 포인터 빠르게 움직일때 꼬리

엉찍했을때 흙먼지는 사방으로 퍼지는데, 이런거 구현하려면 텍스쳐애니메이션 말고도 위치 변경 애니메이션같은게 필요할듯?->이부분은 todo로? 날아갈때 경로를 따라 생성되는 이펙트같은것도 이 구현을 하면서 만들어야할것같아서 결국 해야할것같은..

텍스쳐 인덱스를 바꾸는 애니메이션만 적용하기로 스펙 결정.
이펙트가 대각선으로 나타나야 하는 경우도 있지 않을까? -> 엄밀히 말해서 이 부분은 2d effect가 아니라 라인을 따라서 이펙트가 나타나는 케이스인데, 아예 다른 기하 셰이더를 써야할 것으로 보인다.
이펙트에도 조명이 적용되어야 할까? -> 빛나는 이펙트의 경우에는 적용이 안되어야 할것같은데... 테스트 해보자.

21/08/19
하드웨어 인스턴싱을 이펙트에 적용할건데, 이러면 objectConstant 대신에 instanceDta를 사용해야한다.

materialData를 매 draw마다 바인딩해야한다면 texture를 한번에 바인딩하는게 무슨 이점이 있지? -> 하나라도 줄이는게 낫지...

constexpr int를 constexpr const char*로 바꿀 수 있을까?
나는 material이 renderItem 에 붙어있어서 ObjectConstant에 materialIndex를 넣을수가 없다. 그럼 기존대로 material은 contantBuffer에 넣어서 보내야할것같다. 이펙트는 materialBuffer를 따로 쓰게 할 수 있을까?
혹은 objectConant를 RenderItemConstant로 바꾼다?
effect는 엄밀히 말해서 material에 있는 정보들이 별로 필요없다(diffuse정도) texture만 array로 올려놓고 material은 constantBuffer로 해놓으면 되지않을까. 

21/08/21
cameraGroup이 필요할것같다. 한 그룹 안에서 카메라 타입은 똑같아야 한다. 

21/08/23
아무래도 회전을 쿼터니언으로 안하니까 평균을 내도 값이 이상하다. 카메라 각도를 쿼터니언으로 처리해야겠다.
쿼터니언 -> 회전변환 행렬
upvector direction<->회전변환 행렬

21/08/24
포탈 타고 날아가기
  - 곡선형으로 따라가도록 코드작업 (완료)
  - 어떤 패스를 따라갈지 정하는 부분 코드작업(완료)
  - path이동시 rotate를 어떻게 할지(완료)
  - 데이터 작업(완료)
맵 배치
  - 배경 렌더아이템용 셰이더 작업(완료)
  - 데이터 작업(완료)
카메라작업
  - 평균값방식에서 blend방식으로 바꾸는 코드작업(완료)
  - path타고 날아갈때는 보간이 되어야 할것같은데 타입별로 적용되도록 코드작업 필요할듯(완료)
  - 빈 곳 없게 데이터 채우기(완료)
  - 데이터 채울때 편하게 개발모드에서는 camera 수동조작이 가능하고 현재 카메라 정보를 디버그창에 출력하는 기능 필요(코드) -> 걍 블렌더에서 해와도 될듯?(스펙아웃)
  - 카메라 조작 키입력(완료)
  - 카메라를 키 입력으로 바꿔도 플레이어 포지션으로 다시 계산하면 되돌아가는 문제(완료)
게임성 관련
  - actor variable작업(코인이 일정시간 지나면 사라진다던가) (완료)
  - stage clear 연출
  - 게임오버 연출
  - 굼바와 부딪혔을때 피 닳고 넘어지게(완료)
  - 가운데 구멍 통과할수있게(작업완료)
  - 시간이 된다면 스테이지 이동 기능
UI 데이터 작업
UI 버튼
  - 마우스 포인터로 클릭시 반응하도록 코드 작업(스펙아웃)
UI 점수표시
  - 글꼴을 사용한다면 점수 먹을때 위아래로 살짝 흔들리게 효과만 줄 수 있으면 됨.
  - 숫자 타입을 따로 만들어야한다면 새 element로 작업필요
UI 마우스 포인터
마우스 포인터방향으로 별 쏘기
코드 정리
  - playerActor와 일반 actor를 확실히 분리하던지 합치던지
  - getWorldMatrix에서 right의 방향이 반대로 되어있는것같음. quaternion 고치면서 확인해야함.(완료)
  - shader 종류/define 정리
UI 말풍선
  - direct2D를 사용해서 표시하지만 3d공간에 있는것처럼 표현되어야 함(코드작업) UI group이 Actor를 부모로 가질 수 있을까?(스펙아웃)
이펙트
  - 선형 이펙트(혜성꼬리)(스펙아웃)
  - 액터에게 붙어있는 이펙트(작업 완료)

path rotate때문에 목표 direction을 향해 회전하도록 바뀌어야 할것같은데 이 경우 rotate angle speed는 어느 시점에 적용할지? -> rotation quaternion을 사용(작업완료)
FrameEvent와 Condition에 검증기능을 넣을지
gravity blend
가속도, 속도 단위
파란색 별 클릭해서 날아가는 부분은 moveType을 plane move와 아닌것으로 나누는 작업이 된 이후로 미룬다. (isQuaternionRotation처럼) -> 마우스 클릭 부분만 만들면 사실상 코드작업은 완료된듯

21/08/31
createGameObjectDev에서 _geometries에 make_unique로 mesh를 만들어 넣다가, 중복되어서 자동으로 mesh가 삭제되는데, 이 과정에서 안에있던 d3dresource도 해제되어서 이것을 참조하려다 장치가 뻗었다. 가끔 나는 크래시의 원인도 이런 종류인게 아닐지 확인해봐야 할듯하다.
-> d3dupdate 를 deltaTick이 0일때는 안하고 있었는데 frameresouce index가 update에서 증가하지 않아서 commandList에 걸려있던 commandAlloc을 침범한것 같음. 0903 이후 재발시 다시 확인해야함

21/09/03
28 * 16byte의 메모리릭...->전역변수가 카운트된듯. 체크 시점을 옮겨서 확인완료.

21/09/04
effectInstance를 액터가 들고있다가 삭제되거나 할때 같이 삭제를 해줘야하는데 얼마나 데이터를 들고있어야 할지
name과 instance? 
effect map을 합쳐놓았을때 얻는 이득?  -> 추후 다른 타입의 이펙트가 추가될 경우...? 이펙트 타입이 정말로 하나 더 필요하게 되면 고려하자

21/09/06
ui용 이미지를 미리 로드해놓고 싶기는 한데... function에서  이미지를 바꿔야 할 경우, 이 이미지들은 미리 로드해놓을 방법이 애매하다.

21/09/08
중요도 높은순으로 정리
스타조각 먹어서 2번째 포탈 여는 부분
클리어시 애니메이션/카메라 연출
그랜드스타 이펙트 꾸미기
  - 별가루 이펙트
  - 강조선 이펙트
스테이지 리로드
화면 전환 ui
  - 사망시, 클리어시, 컷씬ui 그래픽 작업
  - ui 애니메이션을 코드에서 어느정도 지원해야 할것같은데... -> 어차피 따로 만들어야 할 각. 타입별로 하드코딩
마우스 포인터
  - 커서 아이콘 작업
  - update 함수 작성
스타구슬 오브젝트 데이터 작성
마우스 포인터로 별 먹기
마우스 포인터로 별 쏘기
코인먹기
UI 작업
엉찍, 스핀 액션
스핀액션 맞았을때 굼바 액션
(스펙아웃 가능선)
물 텍스쳐 움직이기
패스에 cosine보간 적용
사운드매니저
점수판 글자에 테두리
